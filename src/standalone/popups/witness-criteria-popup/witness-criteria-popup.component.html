<div class="dialog-container">
  <div class="dialog-header bg-primary">
    <h1>{{ lang.map.add_external_person }}</h1>
    <app-icon-button tabindex="-1" mat-dialog-close="" class="close-btn" icon="CLOSE"></app-icon-button>
  </div>
  <div class="dialog-content w-[900px] !p-0">
    <mat-tab-group mat-stretch-tabs="false">
      <mat-tab [label]="!isExternal ? lang.map.search : lang.map.person_info">
        <ng-container [ngTemplateOutlet]="searchCriteria"></ng-container>
      </mat-tab>
      @if (!isExternal) {
      <mat-tab [label]="lang.map.results">
        <ng-container [ngTemplateOutlet]="searchResult"></ng-container>
      </mat-tab>
      }
    </mat-tab-group>
    <ng-template #searchCriteria>
      <div class="p-4">
        @if (isExternal && witnessFormGroup) {

        <div [formGroup]="witnessFormGroup" class="grid grid-cols-3 gap-4">
          <app-select-input
            [formControl]="personTypeControl"
            [label]="lang.map.external_person_type"
            bindLabel="getNames"
            bindValue="lookupKey"
            [options]="personTypes" />
          <app-select-input
            [formControl]="witnessTypeControl"
            [label]="lang.map.witness_type"
            bindLabel="getNames"
            bindValue="lookupKey"
            [options]="witnessTypes" />
          <app-input formControlName="arName" [label]="lang.map.ar_name" />
          <app-input formControlName="enName" [label]="lang.map.en_name" />
        </div>

        } @if (isEmployee && employeeFormGroup) {

        <div [formGroup]="employeeFormGroup" class="grid grid-cols-3 gap-4">
          <app-select-input
            [formControl]="personTypeControl"
            [label]="lang.map.external_person_type"
            bindLabel="getNames"
            bindValue="lookupKey"
            [options]="personTypes" />
          <app-select-input
            [formControl]="witnessTypeControl"
            [label]="lang.map.witness_type"
            bindLabel="getNames"
            bindValue="lookupKey"
            [options]="witnessTypes" />
          <app-select-input
            formControlName="employeeDepartmentId"
            [label]="lang.map.administration"
            bindValue="id"
            bindLabel="getNames"
            [options]="administrations" />
          <app-input formControlName="employeeQualificationId" [label]="lang.map.employee_number" />
          <app-input formControlName="arName" [label]="lang.map.ar_name" />
          <app-input formControlName="enName" [label]="lang.map.en_name" />
          <app-input formControlName="qid" [label]="lang.map.qid" />
          <app-input formControlName="employeeQualification" [label]="lang.map.job_title" />
        </div>

        } @if (isBroker) {

        <div [formGroup]="brokerFormGroup" class="grid grid-cols-3 gap-4">
          <app-select-input
            [formControl]="personTypeControl"
            [label]="lang.map.external_person_type"
            bindLabel="getNames"
            bindValue="lookupKey"
            [options]="personTypes" />
          <app-select-input
            [formControl]="witnessTypeControl"
            [label]="lang.map.witness_type"
            bindLabel="getNames"
            bindValue="lookupKey"
            [options]="witnessTypes" />
          <app-input formControlName="code" [label]="lang.map.broker_code" />
          <app-input formControlName="arName" [label]="lang.map.ar_name" />
          <app-input formControlName="enName" [label]="lang.map.en_name" />
          <app-input formControlName="qid" [label]="lang.map.qid" />
          <app-input [label]="lang.map.broker_company_name" />
          <app-input [label]="lang.map.broker_company_number" />
          <app-input [label]="lang.map.broker_company_cr_number" />
          <app-input [label]="lang.map.broker_company_er_number" />
        </div>

        }
      </div>
    </ng-template>

    <ng-template #searchResult>
      @if (isEmployee) {
      <div class="p-4">
        <table mat-table class="table-style table-primary" [dataSource]="employeeDatasource">
          <!-- arName -->
          <ng-container matColumnDef="employee_number">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.employee_number }}</th>
            <td mat-cell *matCellDef="let element">{{ element.code }}</td>
          </ng-container>
          <ng-container matColumnDef="arName">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.ar_name }}</th>
            <td mat-cell *matCellDef="let element">{{ element.arName }}</td>
          </ng-container>
          <ng-container matColumnDef="enName">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.en_name }}</th>
            <td mat-cell *matCellDef="let element">{{ element.enName }}</td>
          </ng-container>
          <ng-container matColumnDef="department">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.en_name }}</th>
            <td mat-cell *matCellDef="let element">{{ element.enName }}</td>
          </ng-container>
          <ng-container matColumnDef="qid">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.qid }}</th>
            <td mat-cell *matCellDef="let element">{{ element.qid }}</td>
          </ng-container>
          <ng-container matColumnDef="jobTitle">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.job_title }}</th>
            <td mat-cell *matCellDef="let element">{{ element.qid }}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="employeeDisplayedColumns"></tr>
          <tr mat-row *matRowDef="let element; columns: employeeDisplayedColumns"></tr>
          <!-- actions -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.actions }}</th>
            <td mat-cell *matCellDef="let element">
              <div class="flex">
                <div [matTooltip]="lang.map.add_offender">
                  <app-icon-button (click)="addEmployee$.next(element)" icon="PLUS_BOX" />
                </div>
              </div>
            </td>
          </ng-container>
          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="p-4" colspan="100">{{ lang.map.no_records_to_display }}</td>
          </tr>
        </table>
      </div>
      } @if (isBroker) {
      <div class="p-4">
        <table mat-table class="table-style table-primary" [dataSource]="brokersDatasource">
          <!-- arName -->
          <ng-container matColumnDef="brokerCode">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.broker_code }}</th>
            <td mat-cell *matCellDef="let element">{{ element.code }}</td>
          </ng-container>
          <ng-container matColumnDef="arName">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.ar_name }}</th>
            <td mat-cell *matCellDef="let element">{{ element.arName }}</td>
          </ng-container>
          <ng-container matColumnDef="enName">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.en_name }}</th>
            <td mat-cell *matCellDef="let element">{{ element.enName }}</td>
          </ng-container>
          <ng-container matColumnDef="companyName">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.broker_company_name }}</th>
            <td mat-cell *matCellDef="let element">--</td>
          </ng-container>
          <ng-container matColumnDef="companyNumber">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.broker_company_number }}</th>
            <td mat-cell *matCellDef="let element">--</td>
          </ng-container>
          <ng-container matColumnDef="qid">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.qid }}</th>
            <td mat-cell *matCellDef="let element">{{ element.qid }}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="brokerDisplayedColumns"></tr>
          <tr mat-row *matRowDef="let element; columns: brokerDisplayedColumns"></tr>
          <!-- actions -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>{{ lang.map.actions }}</th>
            <td mat-cell *matCellDef="let element">
              <div class="flex">
                <div [matTooltip]="lang.map.add_offender">
                  <app-icon-button (click)="addBroker$.next(element)" icon="PLUS_BOX" />
                </div>
              </div>
            </td>
          </ng-container>
          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="p-4" colspan="100">{{ lang.map.no_records_to_display }}</td>
          </tr>
        </table>
      </div>
      }
    </ng-template>
  </div>
  <div class="dialog-footer justify-end">
    <app-button mat-dialog-close="" buttonType="primary-outline">{{ lang.map.close }}</app-button>
    @if (!isExternal) {
    <app-button (click)="search$.next()" buttonType="primary">{{ lang.map.search }}</app-button>
    } @if (isExternal) {
    <app-button (click)="addWitness$.next()" buttonType="primary">{{ lang.map.add }}</app-button>
    }
  </div>
</div>
