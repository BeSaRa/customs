<div
  class="flex bg-gradient-to-br mb-5 from-primary to-primary-light px-3 text-white rounded-lg items-center justify-start py-2">
  <h1 class="text-xl min-h-[3rem] align-middle flex items-center">
    {{ lang.map.draft }} {{ lang.map.menu_investigation }}
  </h1>
  <div class="flex-auto"></div>
  <!--  <app-icon-button [matTooltip]="lang.map.collapse_all" icon="COLLAPSE_ALL" />-->
  <!--  <app-icon-button [matTooltip]="lang.map.expand_all" icon="EXPAND_ALL" />-->
</div>
<div class="relative">
  <mat-card>
    <mat-tab-group [selectedIndex]="selectedTab" (selectedIndexChange)="tabChange($event)" mat-stretch-tabs="false">
      <mat-tab [label]="lang.map.lbl_basic_info">
        <ng-container [ngTemplateOutlet]="basic_info_tab"></ng-container>
      </mat-tab>
      <mat-tab [label]="lang.map.violations">
        <ng-container [ngTemplateOutlet]="violation_tab"></ng-container>
      </mat-tab>
      <mat-tab [label]="lang.map.offenders">
        <ng-container [ngTemplateOutlet]="offenders_tab"></ng-container>
      </mat-tab>
      <mat-tab [label]="lang.map.external_persons">
        <ng-container [ngTemplateOutlet]="external_persons_tab"></ng-container>
      </mat-tab>
    </mat-tab-group>
  </mat-card>

  <ng-template #basic_info_tab>
    <div [formGroup]="form" class="p-4 grid gap-4 grid-cols-1 md:grid-cols-3 lg:grid-cols-4">
      <app-input formControlName="draftFullSerial" [label]="lang.map.report_draft_number" />
      <app-input formControlName="investigationFullSerial" [label]="lang.map.investigation_file_number" />
      <app-input formControlName="createdOn" [label]="lang.map.report_entry_date">
        <input appControl formControlName="createdOn" (click)="datepicker.open()" [matDatepicker]="datepicker" />
        <mat-datepicker touchUi #datepicker />
      </app-input>
      <div class="flex items-center">
        <mat-slide-toggle #securityLevel="matSlideToggle" formControlName="limitedAccess">
          {{ lang.map.limited_access }} : {{ getSecurityLevel(securityLevel.checked) }}
        </mat-slide-toggle>
      </div>
      <app-textarea
        formControlName="description"
        class="col-span-1 md:col-span-2 lg:col-span-4"
        [label]="lang.map.general_explanation_of_violations" />

      <app-case-attachments
        [caseId]="getCaseFolderIdByName('general')"
        [service]="service"
        [title]="lang.map.report_attachments"
        class="col-span-1 md:col-span-2 lg:col-span-4" />
    </div>
  </ng-template>

  <ng-template #violation_tab>
    <div class="p-4">
      <app-violation-list
        (empty)="resetOffendersAndExternalPersons()"
        (violations)="violations = $event"
        [caseId]="model.id" />
    </div>
  </ng-template>

  <ng-template #offenders_tab>
    <div class="p-4">
      <app-offender-list [violations]="violations" [caseId]="model.id" />
    </div>
  </ng-template>

  <ng-template #external_persons_tab>
    <div class="p-4">
      <app-witnesses-list [violations]="violations" [caseId]="model.id" />
    </div>
  </ng-template>

  <app-button (click)="save$.next(SaveTypes.FINAL)">{{ lang.map.save }}</app-button>
</div>
