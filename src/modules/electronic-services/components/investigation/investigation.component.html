<div
  class="bg-gradient-to-br mb-5 from-primary to-primary-light px-3 rounded-lg py-2">
  <div class="flex items-center justify-start text-white">
    <h1 class="text-xl min-h-[3rem] align-middle flex items-center">
      {{ lang.map.draft }} {{ lang.map.menu_investigation }}
    </h1>
    <div class="flex-auto"></div>
    <!--  <app-icon-button [matTooltip]="lang.map.collapse_all" icon="COLLAPSE_ALL" />-->
    <!--  <app-icon-button [matTooltip]="lang.map.expand_all" icon="EXPAND_ALL" />-->
  </div>
  @if (showSummaryElements()) {
    <div
      [formGroup]="form"
      class="grid gap-4 grid-cols-1 md:grid-cols-3 lg:grid-cols-4">
      <div class="mb-3">
        <span class="font-medium text-white">{{
          lang.map.report_draft_number
        }}</span>
        <label class="input-form p-2 block">
          {{ model.draftFullSerial ? model.draftFullSerial : '---' }}
        </label>
      </div>
      <div class="mb-3">
        <span class="font-medium text-white">{{
          lang.map.investigation_file_number
        }}</span>
        <label class="input-form p-2 block">
          {{
            model.investigationFullSerial
              ? model.investigationFullSerial
              : '---'
          }}
        </label>
      </div>
      <div class="mb-3">
        <span class="font-medium text-white">{{
          lang.map.report_entry_date
        }}</span>
        <label class="input-form p-2 block">
          {{ model.createdOn ? (model.createdOn | date) : '---' }}
        </label>
      </div>
      <div class="mb-3">
        <span class="font-medium text-white">{{
          lang.map.level_of_secrecy
        }}</span>
        <label class="input-form p-2 block">
          {{
            model.securityLevelInfo ? model.securityLevelInfo.getNames() : '---'
          }}
        </label>
      </div>
    </div>
  }
</div>
<div
  class="relative"
  [ngClass]="{
    'investigation-tab-group': !showSummaryElements(),
    'investigation-tab-group-preview': showSummaryElements()
  }">
  <mat-card>
    <mat-tab-group
      [(selectedIndex)]="selectedTab"
      (selectedIndexChange)="tabChange($event)"
      mat-stretch-tabs="false">
      @if (showSummaryElements()) {
        <mat-tab [label]="lang.map.basic_report_data_and_violations">
          <ng-container [ngTemplateOutlet]="summary_tab"></ng-container>
        </mat-tab>
      }
      @if (canSave()) {
        <mat-tab [label]="lang.map.lbl_basic_info">
          <ng-container [ngTemplateOutlet]="basic_info_tab"></ng-container>
        </mat-tab>
      }
      <mat-tab [label]="lang.map.offenders">
        <ng-container [ngTemplateOutlet]="offenders_tab"></ng-container>
      </mat-tab>
      <mat-tab [label]="lang.map.violations">
        <ng-container [ngTemplateOutlet]="violation_tab"></ng-container>
      </mat-tab>
      @if (canViewExternalPersonsTab()) {
        <mat-tab [label]="lang.map.external_persons">
          <ng-container
            [ngTemplateOutlet]="external_persons_tab"></ng-container>
        </mat-tab>
      }
      <mat-tab [label]="lang.map.attachments">
        <ng-container [ngTemplateOutlet]="attachments_tab"></ng-container>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
  <app-buttons-case-wrapper
    [model]="model"
    [openFrom]="openFrom"
    [canSave]="canSave()"
    (save)="save$.next($event)"
    (launch)="launchCase($event)"
    (claim)="_updateForm($event)"
    (release)="_updateForm($event)"
    [mandatoryMakePenaltyDecisions]="mandatoryMakePenaltyDecisions"
    (navigateToSamePageThatUserCameFrom)="navigateToSamePageThatUserCameFrom()">
  </app-buttons-case-wrapper>
  <ng-template #summary_tab>
    <app-summary-tab (updateModel)="updateModel$.next(null)" [model]="model" />
  </ng-template>

  <ng-template #basic_info_tab>
    <div
      [formGroup]="form"
      class="p-4 grid gap-4 grid-cols-1 md:grid-cols-3 lg:grid-cols-4">
      <app-input
        formControlName="draftFullSerial"
        [label]="lang.map.report_draft_number" />
      <app-input
        formControlName="investigationFullSerial"
        [label]="lang.map.investigation_file_number" />
      <app-input
        formControlName="createdOn"
        [label]="lang.map.report_entry_date">
        <input
          appControl
          formControlName="createdOn"
          (click)="datepicker.open()"
          [matDatepicker]="datepicker" />
        <mat-datepicker touchUi #datepicker />
      </app-input>
      <app-select-input
        formControlName="securityLevel"
        [label]="lang.map.level_of_secrecy"
        bindValue="lookupKey"
        bindLabel="getNames"
        [options]="violationDegreeConfidentiality" />
      <app-textarea
        formControlName="subject"
        class="col-span-1 md:col-span-2 lg:col-span-4"
        [label]="lang.map.subject" />
      <app-textarea
        formControlName="description"
        [rows]="6"
        class="col-span-1 md:col-span-2 lg:col-span-4"
        [label]="lang.map.general_explanation_of_violations" />
    </div>
  </ng-template>

  <ng-template #offenders_tab>
    <div class="p-4">
      <app-offender-list
        [model]="model"
        [readonly]="readonly"
        [reportType]="getReportType()"
        [canModifyOffenders]="canEdit()"
        (askForSaveModel)="saveCase()"
        (askForViolationListReload)="violationListComponent.reload$.next()"
        (updateModel)="updateModel$.next(null)"
        (focusInvalidTab)="focusInvalidTab()"
        [hasValidInvestigationSubject]="hasValidInvestigationSubject()" />
    </div>
    <!--        (offenders)="offenders = $event"-->
  </ng-template>

  <ng-template #violation_tab>
    <div class="p-4">
      <app-violation-list
        #violationListComponent
        [reportType]="getReportType()"
        [readonly]="readonly"
        [model]="model"
        [canModifyOffenders]="canEdit()"
        (askForSaveModel)="saveCase()"
        (focusInvalidTab)="focusInvalidTab()"
        (updateModel)="updateModel$.next(null)"
        [hasValidInvestigationSubject]="hasValidInvestigationSubject()" />
    </div>
  </ng-template>
  <ng-template #external_persons_tab>
    <div class="p-4">
      <app-witnesses-list [model]="model" [readonly]="readonly" />
    </div>
  </ng-template>

  <ng-template #attachments_tab>
    <div class="p-4">
      <app-case-attachments
        [caseId]="getCaseFolderIdByName(folderType.GENERAL)"
        [service]="service"
        [readonly]="readonly"
        [title]="lang.map.report_attachments"
        class="col-span-1 md:col-span-2 lg:col-span-4" />
      <app-case-attachments
        [caseId]="getCaseFolderIdByName(folderType.OFFICIAL)"
        [service]="service"
        [readonly]="readonly"
        [title]="lang.map.correspondence_attachments"
        class="col-span-1 md:col-span-2 lg:col-span-4" />
      <app-offender-attachments
        [model]="model"
        class="col-span-1 md:col-span-2 lg:col-span-4"
        [readOnly]="readonly" />
    </div>
  </ng-template>
</div>
